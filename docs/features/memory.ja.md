# メモリ & Sleep

## 永続的な記憶

Riverse はセッションを超えて記憶し、あなたと共に進化するタイムラインベースのプロファイルを構築します。すべての会話が、性格、好み、経験、人間関係の理解を深めます。

これは**河流アルゴリズム**によって実現されます — 会話は水の流れ、重要な情報は河床の堆積物のように沈殿し、複数ターンの検証を経て「推測」から「確認」へ、さらに「確立」へと昇格します。

## Sleep — オフライン記憶統合

Sleep は Riverse が会話を消化し、プロフィールを更新するプロセスです。自動・手動の両方で実行可能：

| トリガー | 方法 |
|---|---|
| **Telegram** | `/new` を送信 — セッションをリセットし、バックグラウンドで Sleep を実行 |
| **CLI** | 終了時に自動実行（`quit` または Ctrl+C） |
| **REST API** | `POST /sleep` |
| **cron（推奨）** | 毎晩の定時ジョブで一日の会話を統合 |

### cron の例

毎日 0 時に Sleep を実行：

```bash
# crontab -e
0 0 * * * cd /path/to/JKRiver && /path/to/python -c "from agent.sleep import run; run()"
```

## セマンティック検索

埋め込み（BGE-M3）を有効にすると、キーワードではなく意味で関連する記憶を検索できます。

```yaml
embedding:
  enabled: true
  model: "bge-m3"
  api_base: "http://localhost:11434"
```

## メモリの精度

!!! info
    現在、個人プロファイル抽出に特化して訓練された LLM は存在しないため、抽出結果に誤りが含まれる場合があります。不正確な内容を見つけた場合は、Web ダッシュボードで誤った記憶を**拒否**するか、古くなった記憶を**クローズ**できます。Riverse は記憶内容の手動編集を意図的にサポートしていません — 誤った記憶は河の中の泥沙のように、水流に洗い流されるべきものであり、人の手で河床を削るべきではありません。会話が蓄積されるにつれ、河流アルゴリズムがマルチターン検証と矛盾検出により継続的に自己修正し、プロファイルはより正確になっていきます。
